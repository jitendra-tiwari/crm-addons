<html>
<head>
    <meta>
    <meta>
</head>
<body onload="getAllEntites()">
    ﻿

    <!--<snippetMetaDataDemo>-->


    <title>dotsquares</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <script src="ClientGlobalContext.js.aspx" type="text/javascript"></script>
    <script src="new_SDK.MetaData.js" type="text/javascript"></script>
    <script type="text/javascript">
  // An unordered list element to add Entity list items to
  var results;
  // An area to display messages
  var message;

  // Alert flag to indicate the changes
  var alertFlag;

  //dropdownlist
  var selectbox;

  var attributeSelectBox;

  function getAllEntites() {
   ///<summary>
   /// Initializes the sample when the document is ready
   ///</summary>
   //Assign the global variables
   //results = document.getElementById("results");
   message = document.getElementById("message");
   alertFlag = document.getElementById("dispalert");
   selectbox=document.getElementById("selectbox_AllEntites");
   attributeSelectBox=document.getElementById("selectbox_Allattributes");

   //document.getElementById("btnstartSample").setAttribute("disabled", "disabled");
   //Retrieve entities
   SDK.Metadata.RetrieveAllEntities(SDK.Metadata.EntityFilters.Entity,
    false,
    successRetrieveAllEntities,
    errorRetrieveAllEntities);
  // setText(message, "Loading...");

  }

  function successRetrieveAllEntities(entityMetadataCollection) {
   ///<summary>
   /// Receives the data from SDK.Metadata.RetrieveAllEntities and
   /// appends a list item to results for each one.
   ///</summary>

   entityMetadataCollection.sort(function (a, b) {
    if (a.LogicalName < b.LogicalName)
    { return -1 }
    if (a.LogicalName > b.LogicalName)
    { return 1 }
    return 0;
   });

   for (var i = 0; i < entityMetadataCollection.length; i++) {

    var entity = entityMetadataCollection[i];


var optn = document.createElement("option");
if(entity.DisplayName.UserLocalizedLabel!=null)
{
optn.text = entity.DisplayName.UserLocalizedLabel.Label;

optn.value = entity.LogicalName;

selectbox.options.add(optn);
  }


   }

  }
  function errorRetrieveAllEntities(error) {
   ///<summary>
   /// Displays the error returned from  SDK.Metadata.RetrieveAllEntities if it fails.
   ///</summary>
   setText(message, error.message);
   if (alertFlag.checked == true)
    alert("An Error occurred.");
  }

  function retrieveAttributes() {
   ///<summary>
   /// Retrieves attributes for the entity list item that is clicked
   ///</summary>

   // clear first time attributes of entity
var theDropDown = document.getElementById("selectbox_Allattributes");
var numberOfOptions = theDropDown.options;

   for (i=0; i<numberOfOptions.length; i++) {
   if(numberOfOptions[i].value!="")
   {

   theDropDown.remove(i);
   }
}

   var e = document.getElementById("selectbox_AllEntites");
   var logicalEntityName = e.options[e.selectedIndex].value;

 if(logicalEntityName!="")
 {

    var entityLogicalName = logicalEntityName;

   // setText(notification, "   Retrieving attributes for " + getText(this) + "...");

    SDK.Metadata.RetrieveEntity(SDK.Metadata.EntityFilters.Attributes,
    logicalEntityName,
    null,
    false,
    function (entityMetadata) { successRetrieveEntity(entityLogicalName, entityMetadata); },
    errorRetrieveEntity);
}


  }

  function successRetrieveEntity(logicalName, entityMetadata) {
   ///<summary>
   /// Retrieves attributes for the entity list item that is clicked
   ///</summary>

   // Update the entity list item notification when data is retrieved.

   entityMetadata.Attributes.sort(function (a, b) {
    if (a.LogicalName < b.LogicalName)
    { return -1 }
    if (a.LogicalName > b.LogicalName)
    { return 1 }
    return 0;
   });


   for (var i = 0; i < entityMetadata.Attributes.length; i++) {
    var attribute = entityMetadata.Attributes[i];

	var optn = document.createElement("option");
if(attribute.DisplayName.UserLocalizedLabel!=null)
{
optn.text = attribute.DisplayName.UserLocalizedLabel.Label;

optn.value = attribute.SchemaName;

attributeSelectBox.options.add(optn);


 }
   }

  }
  function errorRetrieveEntity(error) {
   ///<summary>
   /// Displays the error returned from SDK.Metadata.RetrieveEntity if it fails.
   ///</summary>
   setText(message, error.message);
   if (alertFlag.checked == true)
    alert("Error!");
  }

  function toggleDisplayAttributes() {
   ///<summary>
   /// toggles whether the list of attributes is displayed.
   ///</summary>

   if (this.parentElement.attributesDisplayed) {
    this.parentElement.lastChild.style.display = "none";
    this.parentElement.attributesDisplayed = false;
    this.title = "Click to show attributes.";

    if (alertFlag.checked == true)
     alert("Attributes were hidden.");
   }
   else {
    this.parentElement.lastChild.style.display = "block";
    this.parentElement.attributesDisplayed = true;
    this.title = "Click to hide attributes.";

    if (alertFlag.checked == true)
     alert("Attributes are displayed.");
   }

  }

  // setText and getText mitigate differences in how browsers set or get text content.
  function setText(node, text) {
   if (typeof (node.innerText) != "undefined") {
    node.innerText = text;

   }
   else {
    node.textContent = text;

   }

  }

  function getText(node) {
   if (typeof (node.innerText) != "undefined") {
    return node.innerText;
   }
   else {
    return node.textContent;
   }
  }

    </script>

    <div id="message">
    </div>
    <table style="width: 100%;">
        <tbody>
            <tr class="targetoptions">
                <td class="tdtargetoptions" id="td1" style="width: 106px;">
                    <label id="entityLabel" class="crm2013TextStyle">
                         Entity<span style="color: Red;">*</span>
                    </label>
                </td>
                <td>
                    <select id="selectbox_AllEntites" style="width:300px;" name="CRM_Entites" onchange="retrieveAttributes()">
                        <option value="">---Select Entity---</option>
                    </select>
                </td>
            </tr>
            <tr class="targetoptions">
                <td class="tdtargetoptions" id="td3" style="width: 106px;">
                    <label id="attributeLabel" class="crm2013TextStyle">
                         Attribute<span style="color: Red;">*</span>
                    </label>
                </td>
                <td class="tdtargetoptions" id="td4">
                    <select id="selectbox_Allattributes" style="width:300px;" name="CRM_Attributes">
                        <option value="">---Select Attribute---</option>
                    </select>
                </td>
            </tr>
        </tbody>
    </table>






</body><!--</snippetMetaDataDemo>-->
</html>